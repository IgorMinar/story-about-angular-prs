<!doctype html>
<html style="height: 100%; margin: 0">
<head>
  <title>Life of an AngularJS PR</title>
<style>
/* scale out */
body.outward {
  -webkit-transition:0.2s  all;
  transition:0.2s linear all;
}

/* translate out */
body.outward #wrapper {
  -webkit-transition:0.6s  all;
  transition:0.6s linear all;
}

/* scale in */
body.inward {
  -webkit-transition:0.8s  all;
  transition:0.8s linear all;
}

/* translate in */
body.inward #wrapper {
  -webkit-transition:0.5s  all;
  transition:0.5s linear all;
}
#wrapper > .b,
#wrapper > img {
  display:none;
}
#wrapper.s1 > .m1,
#wrapper.s2 > .m2,
#wrapper.s3 > .m3,
#wrapper.s4 > .m4,
#wrapper.s1 .b1,
#wrapper.s2 .b2,
#wrapper.s3 .b3,
#wrapper.s4 .b4 {
  display:block;
}
</style>
</head>
<body style="width: 100%; height: 100%; overflow: hidden; margin: 0">

  <div id="wrapper" class="s1" style="position: absolute">
    <img class="m1" src="IMG_20140106_114712.jpg">
    <img class="m2" src="IMG_20140106_114856.jpg">
    <img class="m3" src="IMG_20140106_115210.jpg">
    <img class="m4" src="IMG_20140106_115259.jpg">
  </div>


  <script>
    (function(window, document) {
      var ZOOM_VECTOR = 0.5;
      var TRANSLATE_VECTOR_X = -0.1;
      var TRANSLATE_VECTOR_Y = 1;

      var presentation = [];
      var slides = {_length: 0};
      var currentSlideIndex = -1;
      var rectangle;
      var slide;


      function Slide(index, name, x, y, width, height, fullpage) {
        this.index = index;
        this.name = name;
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
        this.fullpage = fullpage;

        slides[name] = this;
        slides._length++;
      }

      //new Slide(1, 'page', 0, 0, 2368, 3200, true);
      presentation.push(new Slide(1, 'title', 550, 50, 850, 200));
      presentation.push(new Slide(1, 'Angular logo', 200, 270, 800, 500));
      presentation.push(new Slide(1, 'bug', 200, 820, 800, 500));
      presentation.push(new Slide(1, 'idea', 1120, 780, 800, 500));
      presentation.push(new Slide(1, 'Angular rocket', 200, 1420, 800, 500));

      presentation.push(new Slide(2, 'send PR', 310, 70, 700, 400));
      presentation.push(new Slide(2, 'new PR', 1110, 50, 600, 400));
      presentation.push(new Slide(2, 'triage', 340, 510, 600, 450));
      presentation.push(new Slide(2, 'triage photo', 1100, 510, 600, 450));
      presentation.push(new Slide(2, 'triage labels', 350, 1050, 600, 450));
      presentation.push(new Slide(2, 'triage outcome', 1080, 1050, 680, 480));

      //presentation.push(new Slide(2, 'page2', 0, 0, 2368, 3200, true));


      function slider(event) {
        switch (event.keyCode) {
          case 39:
            moveBy(1);
            break;
          case 37:
            moveBy(-1);
            break;
        }


        function moveBy(increment) {
          currentSlideIndex = currentSlideIndex + increment;

          if (0 > currentSlideIndex || currentSlideIndex >= slides._length) {
            currentSlideIndex = currentSlideIndex - increment;
            return; // OOB
          }

          console.log('going from slide #', currentSlideIndex, ' to ', currentSlideIndex - increment);

          var slide = presentation[currentSlideIndex];
          var wrapper = window.wrapper;

          wrapper.className = 's' + slide.index;

          var destCoords = translate(slide);
          var destScale = scale(slide);

          if(slide.fullpage) {
            pan('outward', destCoords, destScale);
          } else {
            var startCoords = translate(slide, TRANSLATE_VECTOR_X, TRANSLATE_VECTOR_Y);
            startCoords[0] += (destCoords[0] - startCoords[0]) / 2;
            startCoords[1] += (destCoords[1] - startCoords[1]) / 2;

            var startScale = scale(slide, ZOOM_VECTOR);

            pan('outward', startCoords, startScale, function() {
              pan('inward', destCoords, destScale);
            });
          }

        }

        function pan(direction, translateVal, scaleVal, done) {
          document.body.className = direction;
          document.body.style['-webkit-transform'] = 'scale( ' + scaleVal.join(',') + ')';

          var wrapper = window.wrapper;
          translateVal = translateVal[0] + 'px, ' + translateVal[1] + 'px';
          wrapper.style['-webkit-transform'] = 'translate(' + translateVal + ')';

          var total = 0, count = 0;
          setupEvents(wrapper);
          setupEvents(document.body);

          function setupEvents(element) {
            total++;
            element.addEventListener('transitionend', animateEnd);

            function animateEnd() {
              element.removeEventListener('transitionend', animateEnd);
              if(++count == total) {
                done && done();
              }
            }
          };
        }
      };


      function translate(slide, zoomX, zoomY) {
        var viewportWidth = document.documentElement.clientWidth;
        var viewportHeight = document.documentElement.clientHeight;

        var viewportCenterX = viewportWidth / 2;
        var viewportCenterY = viewportHeight / 2;
        var slideCenterX = (slide.width / 2) + slide.x;
        var slideCenterY = (slide.height / 2) + slide.y;

        var translateX = (viewportCenterX - slideCenterX) * (zoomX || 1);
        var translateY = (viewportCenterY - slideCenterY) * (zoomY || 1);

        return [translateX, translateY];
      }

      function scale(slide, zoom) {
        zoom = zoom || 1;
        var viewportWidth = document.documentElement.clientWidth;
        var viewportHeight = document.documentElement.clientHeight;

        var scale = Math.min(viewportWidth / slide.width, viewportHeight / slide.height) * zoom;

        return [scale, scale];
      }


      function renderRectangles(slides) {
        for (var slideName in slides) {
          slide = slides[slideName];

          rectangle = document.createElement('div');
          rectangle.className = 'b b' + slide.index;
          rectangle.style.position = 'absolute';
          rectangle.style.border = '2px solid yellow';
          rectangle.style.top = slide.y + 'px';
          rectangle.style.left = '' + slide.x + 'px';
          rectangle.style.width = slide.width + 'px';
          rectangle.style.height = slide.height + 'px';

          window.wrapper.appendChild(rectangle);
        }
      }

      renderRectangles(slides);
      document.addEventListener('keydown', slider, false);
      document.addEventListener('load', function() { moveBy(1); }, false);

    }(window, document));
  </script>
</body>
</html>
